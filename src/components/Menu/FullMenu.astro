---
import NavMenu from "./NavMenu.astro";

import ItemsMenu from "./ItemsMenu.astro";

const arrChocolate = [
  {
    id: "chc-00",
    title: "Cheesecake de Morango",
    source: "src/assets/products-images/pexels-suzyhazelwood-1126359.jpg",
    alt: "alt",
    details: "Torta de queijo cremosa com calda ou geleia de morango por cima.",
    price: "R$ 18,99",
  },
  {
    id: "choc-01",
    title: "Bolo Red Velvet",
    source:
      "src/assets/products-images/pexels-alejandro-aznar-155337093-30694835.jpg",
    alt: "alt",
    details:
      "Um bolo macio com um distintivo sabor de cacau e cor vermelha, coberto com cream cheese.",
    price: "R$ 34,99",
  },
  {
    id: "choc-02",
    title: "Éclair de Chocolate",
    source: "src/assets/products-images/pexels-ron-lach-10117826.jpg",
    alt: "alt",
    details:
      "Massa folhada recheada com creme de baunilha ou chocolate e coberta com ganache.",
    price: "R$ 15,99",
  },
  {
    id: "choc-03",
    title: "Torta de Limão Merengue ",
    source: "src/assets/products-images/pexels-lina-5732159.jpg",
    alt: "alt",
    details:
      "Base de massa crocante, recheio cítrico de limão e merengue dourado por cima.",
    price: "R$ 11,99",
  },
  {
    id: "choc-04",
    title: "Macaron de Framboesa ",
    source:
      "src/assets/products-images/pexels-anna-pyshniuk-2453945-11065339.jpg",
    alt: "alt",
    details:
      "Biscoitos leves de amêndoa com recheio de ganache ou geleia de framboesa.",
    price: "R$ 7,89",
  },
  {
    id: "choc-05",
    title: "Brigadeiro Gourmet",
    source:
      "src/assets/products-images/pexels-evilin-silva-2101620640-31983295.jpg",
    alt: "alt",
    details:
      "Versão sofisticada do clássico brasileiro, com coberturas como castanhas, chocolate belga ou frutas.",
    price: "R$ 4,99",
  },
];

const arrDocesVeganos = [
  {
    id: "veg-00",
    title: "Brownie Vegano de Cacau",
    source: "src/assets/products-images/pexels-suzyhazelwood-1126359.jpg",
    alt: "alt",
    details:
      "Brownie vegano com toque de cacau e nozes, sem ingredientes derivados de animais.",
    price: "R$ 12,50",
  },
  {
    id: "veg-01",
    title: "Mousse de Chocolate Vegano",
    source:
      "src/assets/products-images/pexels-alejandro-aznar-155337093-30694835.jpg",
    alt: "alt",
    details: "Mousse leve e aerado feito com abacate e cacau, sem laticínios.",
    price: "R$ 14,99",
  },
  {
    id: "veg-02",
    title: "Cheesecake Vegano de Frutas Vermelhas",
    source: "src/assets/products-images/pexels-suzyhazelwood-1126359.jpg",
    alt: "alt",
    details:
      "Cheesecake cremoso com base de castanhas e compota de frutas vermelhas.",
    price: "R$ 19,99",
  },
  {
    id: "veg-03",
    title: "Bolo de Cenoura Vegano",
    source: "src/assets/products-images/pexels-suzyhazelwood-1126359.jpg",
    alt: "alt",
    details: "Bolo úmido com cenoura e glacê de laranja, sem ovos ou leite.",
    price: "R$ 16,50",
  },
  {
    id: "veg-04",
    title: "Torta de Limão Vegana",
    source: "src/assets/products-images/pexels-suzyhazelwood-1126359.jpg",
    alt: "alt",
    details:
      "Torta refrescante com creme de limão e base de biscoito integral vegano.",
    price: "R$ 17,99",
  },
  {
    id: "veg-05",
    title: "Cookie Vegano de Chocolate",
    source: "src/assets/products-images/pexels-suzyhazelwood-1126359.jpg",
    alt: "alt",
    details:
      "Cookie macio com pedaços de chocolate meio amargo e aveia, totalmente vegano.",
    price: "R$ 8,99",
  },
];

const arrBiscoitos = [
  {
    id: "bisc-00",
    title: "Biscoito de Chocolate e Amêndoas",
    source: "src/assets/products-images/pexels-suzyhazelwood-1126359.jpg",
    alt: "alt",
    details: "Biscoito crocante com pedaços de chocolate e amêndoas torradas.",
    price: "R$ 6,99",
  },
  {
    id: "bisc-01",
    title: "Cookie de Gengibre",
    source: "src/assets/products-images/pexels-suzyhazelwood-1126359.jpg",
    alt: "alt",
    details: "Cookie aromático de gengibre com uma pitada de canela.",
    price: "R$ 5,99",
  },
  {
    id: "bisc-02",
    title: "Biscoito de Aveia com Passas",
    source: "src/assets/products-images/pexels-suzyhazelwood-1126359.jpg",
    alt: "alt",
    details: "Biscoito tradicional com sabor reconfortante de aveia e passas.",
    price: "R$ 4,99",
  },
  {
    id: "bisc-03",
    title: "Biscoito Integral de Linhaça",
    source: "src/assets/products-images/pexels-suzyhazelwood-1126359.jpg",
    alt: "alt",
    details: "Biscoito rico em fibras, feito com farinha integral e linhaça.",
    price: "R$ 7,50",
  },
  {
    id: "bisc-04",
    title: "Biscoito de Limão Siciliano",
    source: "src/assets/products-images/pexels-suzyhazelwood-1126359.jpg",
    alt: "alt",
    details: "Biscoito refrescante com raspas e suco de limão siciliano.",
    price: "R$ 6,50",
  },
  {
    id: "bisc-05",
    title: "Biscoito Recheado de Nutella",
    source: "src/assets/products-images/pexels-suzyhazelwood-1126359.jpg",
    alt: "alt",
    details: "Biscoito macio recheado com creme de avelã e cacau.",
    price: "R$ 8,50",
  },
];

const arrEspeciaisDaCasa = [
  {
    id: "espc-00",
    title: "Torta Caseira de Maçã",
    source: "src/assets/products-images/pexels-suzyhazelwood-1126359.jpg",
    alt: "alt",
    details:
      "Deliciosa torta de maçã com massa fina e recheio de maçã e canela.",
    price: "R$ 15,99",
  },
  {
    id: "espc-01",
    title: "Pão de Queijo Especial",
    source:
      "src/assets/products-images/pexels-anna-pyshniuk-2453945-11065339.jpg",
    alt: "alt",
    details:
      "Pão de queijo quentinho, com textura perfeita, receita exclusiva da casa.",
    price: "R$ 12,99",
  },
  {
    id: "espc-02",
    title: "Bolo de Fubá com Erva-doce",
    source: "src/assets/products-images/pexels-suzyhazelwood-1126359.jpg",
    alt: "alt",
    details:
      "Bolo tradicional com sabor marcante de fubá e erva-doce, autêntico da casa.",
    price: "R$ 13,50",
  },
  {
    id: "espc-03",
    title: "Muffin de Blueberry",
    source: "src/assets/products-images/pexels-suzyhazelwood-1126359.jpg",
    alt: "alt",
    details:
      "Muffin macio com mirtilos frescos e toque de baunilha, feito na hora.",
    price: "R$ 9,99",
  },
  {
    id: "espc-04",
    title: "Quindim Tradicional",
    source: "src/assets/products-images/pexels-suzyhazelwood-1126359.jpg",
    alt: "alt",
    details:
      "Doce tipicamente brasileiro com textura sedosa e sabor marcante de coco.",
    price: "R$ 7,99",
  },
  {
    id: "espc-05",
    title: "Pudim de Leite Condensado",
    source: "src/assets/products-images/pexels-suzyhazelwood-1126359.jpg",
    alt: "alt",
    details:
      "Pudim cremoso de leite condensado com calda caramelizada, irresistível.",
    price: "R$ 10,99",
  },
];
---

<section
  aria-labelledby="menu-heading"
  role="region"
  class="min-h-screen overflow-x-hidden flex flex-col gap-[8vh] p-4 pl-1 pr-0 bg-[#ffebf2] lg:gap-[8vh]"
>
  <NavMenu />
  <header class="pt-20 md:pt-0">
    <h1
      id="menu-heading"
      class="text-5xl text-center text-[#800040] font-medium lg:text-6xl"
    >
      Lorem ipsum
    </h1>
  </header>
  <main class="flex flex-col gap-8">
    <ItemsMenu sectionTitle="Doces de chocolate" arr={arrChocolate} />
    <ItemsMenu sectionTitle="Doces Veganos" arr={arrDocesVeganos} />
    <ItemsMenu sectionTitle="Biscoitos" arr={arrBiscoitos} />
    <ItemsMenu sectionTitle="Especiais da Casa" arr={arrEspeciaisDaCasa} />
    <div
      class="w-full h-10 bg-[#ffebf2] border-1 border-[#ffdae9] rounded-3xl self-center lg:max-w-[1280px]"
    >
    </div>
  </main>
  <footer class="self-center">
    <div>
      <button
        class="font-semibold font-nunito bg-emerald-500 text-[#ffffff] p-4 rounded-3xl shadow-sm"
        >Finalizar pedido</button
      >
    </div>
  </footer>
</section>

<style>
  section {
    scrollbar-color: transparent transparent;
    scrollbar-width: thin;
  }
</style>

<script>
  import { cart, salvarCarrinho, notifyCartChange } from "../../lib/store.js";

  let total;

  // Adiciona o listener aos botões de adicionar
  document.querySelectorAll(".add-btn").forEach((button) => {
    button.addEventListener("click", (e) => {
      const card = e.target.closest(".card-item");
      if (!card) return;
      addToCart(card);

      notifyCartChange();

      salvarCarrinho();
    });
  });

  // Adiciona o listener aos botões de remover
  document.querySelectorAll(".rmv-btn").forEach((button) => {
    button.addEventListener("click", (e) => {
      const card = e.target.closest(".card-item");
      if (!card) return;
      removeFromCart(card);

      notifyCartChange();

      salvarCarrinho();
    });
  });

  // Função para adicionar um produto ao array
  function addToCart(card) {
    const id = card.id;
    const titulo = card.querySelector("header h2").textContent;
    const precoTexto = card.querySelector("footer p").textContent;

    const preco = parseFloat(
      precoTexto
        .replace("R$", "") // remove o símbolo de moeda
        .trim() // remove os espaços laterais
        .replace(/\./g, "") // remove pontos que podem ser separadores de milhar
        .replace(",", ".") // converte a vírgula para ponto
    );

    // Busca se o produto já existe no carrinho
    const produtoExistente = cart.find((produto) => produto.id === id);

    if (produtoExistente) {
      // Incrementa a quantidade
      produtoExistente.quantidade++;
      console.log(
        `Incrementando quantidade de ${titulo} para ${produtoExistente.quantidade}`
      );
      console.log(cart);
    } else {
      // Cria um novo objeto com quantidade inicial 1 e adiciona ao carrinho
      const novoProduto = { id, titulo, preco, quantidade: 1 };
      cart.push(novoProduto);
      console.log(`Produto adicionado: ${titulo}`);
      console.log(cart);
    }
  }

  // Função para remover um produto do array
  function removeFromCart(card) {
    const id = card.id;
    const titulo = card.querySelector("header h2").textContent;

    const index = cart.findIndex((produto) => produto.id === id);

    if (index > -1) {
      if (cart[index].quantidade > 1) {
        // Diminui a quantidade se houver mais de um
        cart[index].quantidade--;
        console.log(
          `Decrementando quantidade de ${titulo} para ${cart[index].quantidade}`
        );
      } else {
        // Remove o produto se a quantidade for igual a 1
        cart.splice(index, 1);
        console.log(`Produto removido: ${titulo}`);
      }
    } else {
      console.log(`Produto ${titulo} não encontrado no carrinho.`);
    }
  }
</script>
