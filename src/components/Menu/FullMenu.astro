---
import NavMenu from "./NavMenu.astro";

import ItemsMenu from "./ItemsMenu.astro";

import prod00 from "../../assets/products-images/pexels-suzyhazelwood-1126359.jpg";
import prod01 from "../../assets/products-images/pexels-alejandro-aznar-155337093-30694835.jpg";
import prod02 from "../../assets/products-images/pexels-ron-lach-10117826.jpg";
import prod03 from "../../assets/products-images/pexels-lina-5732159.jpg";
import prod04 from "../../assets/products-images/pexels-anna-pyshniuk-2453945-11065339.jpg";
import prod05 from "../../assets/products-images/pexels-evilin-silva-2101620640-31983295.jpg";

const productAlts = {
  prod00:
    "Cheesecake de morango fatiado com calda de morango e frutas frescas.",
  prod01: "Fatia de bolo Red Velvet com cobertura cremosa.",
  prod02: "Éclair de chocolate com recheio cremoso e cobertura de ganache.",
  prod03: "Torta de limão merengue com merengue tostado no topo.",
  prod04: "Macarons coloridos de framboesa em uma pilha.",
  prod05: "Brigadeiros gourmet decorados com granulados.",
};

const arrChocolate = [
  {
    id: "chc-00",
    title: "Cheesecake de Morango",
    source: prod00,
    alt: productAlts.prod00,
    details: "Torta de queijo cremosa com calda ou geleia de morango por cima.",
    price: "R$ 18,99",
  },
  {
    id: "choc-01",
    title: "Bolo Red Velvet",
    source: prod01,
    alt: productAlts.prod01,
    details:
      "Um bolo macio com um distintivo sabor de cacau e cor vermelha, coberto com cream cheese.",
    price: "R$ 34,99",
  },
  {
    id: "choc-02",
    title: "Éclair de Chocolate",
    source: prod02,
    alt: productAlts.prod02,
    details:
      "Massa folhada recheada com creme de baunilha ou chocolate e coberta com ganache.",
    price: "R$ 15,99",
  },
  {
    id: "choc-03",
    title: "Torta de Limão Merengue",
    source: prod03,
    alt: productAlts.prod03,
    details:
      "Base de massa crocante, recheio cítrico de limão e merengue dourado por cima.",
    price: "R$ 11,99",
  },
  {
    id: "choc-04",
    title: "Macaron de Framboesa",
    source: prod04,
    alt: productAlts.prod04,
    details:
      "Biscoitos leves de amêndoa com recheio de ganache ou geleia de framboesa.",
    price: "R$ 7,89",
  },
  {
    id: "choc-05",
    title: "Brigadeiro Gourmet",
    source: prod05,
    alt: productAlts.prod05,
    details:
      "Versão sofisticada do clássico brasileiro, com coberturas como castanhas, chocolate belga ou frutas.",
    price: "R$ 4,99",
  },
];

const arrDocesVeganos = [
  {
    id: "veg-00",
    title: "Brownie Vegano de Cacau",
    source: prod00,
    alt: productAlts.prod00,
    details:
      "Brownie vegano com toque de cacau e nozes, sem ingredientes derivados de animais.",
    price: "R$ 12,50",
  },
  {
    id: "veg-01",
    title: "Mousse de Chocolate Vegano",
    source: prod01,
    alt: productAlts.prod01,
    details: "Mousse leve e aerado feito com abacate e cacau, sem laticínios.",
    price: "R$ 14,99",
  },
  {
    id: "veg-02",
    title: "Cheesecake Vegano de Frutas Vermelhas",
    source: prod02,
    alt: productAlts.prod02,
    details:
      "Cheesecake cremoso com base de castanhas e compota de frutas vermelhas.",
    price: "R$ 19,99",
  },
  {
    id: "veg-03",
    title: "Bolo de Cenoura Vegano",
    source: prod03,
    alt: productAlts.prod03,
    details: "Bolo úmido com cenoura e glacê de laranja, sem ovos ou leite.",
    price: "R$ 16,50",
  },
  {
    id: "veg-04",
    title: "Torta de Limão Vegana",
    source: prod04,
    alt: productAlts.prod04,
    details:
      "Torta refrescante com creme de limão e base de biscoito integral vegano.",
    price: "R$ 17,99",
  },
  {
    id: "veg-05",
    title: "Cookie Vegano de Chocolate",
    source: prod05,
    alt: productAlts.prod05,
    details:
      "Cookie macio com pedaços de chocolate meio amargo e aveia, totalmente vegano.",
    price: "R$ 8,99",
  },
];

const arrBiscoitos = [
  {
    id: "bisc-00",
    title: "Biscoito de Chocolate e Amêndoas",
    source: prod00,
    alt: productAlts.prod00,
    details: "Biscoito crocante com pedaços de chocolate e amêndoas torradas.",
    price: "R$ 6,99",
  },
  {
    id: "bisc-01",
    title: "Cookie de Gengibre",
    source: prod01,
    alt: productAlts.prod01,
    details: "Cookie aromático de gengibre com uma pitada de canela.",
    price: "R$ 5,99",
  },
  {
    id: "bisc-02",
    title: "Biscoito de Aveia com Passas",
    source: prod02,
    alt: productAlts.prod02,
    details: "Biscoito tradicional com sabor reconfortante de aveia e passas.",
    price: "R$ 4,99",
  },
  {
    id: "bisc-03",
    title: "Biscoito Integral de Linhaça",
    source: prod03,
    alt: productAlts.prod03,
    details: "Biscoito rico em fibras, feito com farinha integral e linhaça.",
    price: "R$ 7,50",
  },
  {
    id: "bisc-04",
    title: "Biscoito de Limão Siciliano",
    source: prod04,
    alt: productAlts.prod04,
    details: "Biscoito refrescante com raspas e suco de limão siciliano.",
    price: "R$ 6,50",
  },
  {
    id: "bisc-05",
    title: "Biscoito Recheado de Nutella",
    source: prod05,
    alt: productAlts.prod05,
    details: "Biscoito macio recheado com creme de avelã e cacau.",
    price: "R$ 8,50",
  },
];

const arrEspeciaisDaCasa = [
  {
    id: "espc-00",
    title: "Torta Caseira de Maçã",
    source: prod00,
    alt: productAlts.prod00,
    details:
      "Deliciosa torta de maçã com massa fina e recheio de maçã e canela.",
    price: "R$ 15,99",
  },
  {
    id: "espc-01",
    title: "Pão de Queijo Especial",
    source: prod01,
    alt: productAlts.prod01,
    details:
      "Pão de queijo quentinho, com textura perfeita, receita exclusiva da casa.",
    price: "R$ 12,99",
  },
  {
    id: "espc-02",
    title: "Bolo de Fubá com Erva-doce",
    source: prod02,
    alt: productAlts.prod02,
    details:
      "Bolo tradicional com sabor marcante de fubá e erva-doce, autêntico da casa.",
    price: "R$ 13,50",
  },
  {
    id: "espc-03",
    title: "Muffin de Blueberry",
    source: prod03,
    alt: productAlts.prod03,
    details:
      "Muffin macio com mirtilos frescos e toque de baunilha, feito na hora.",
    price: "R$ 9,99",
  },
  {
    id: "espc-04",
    title: "Quindim Tradicional",
    source: prod04,
    alt: productAlts.prod04,
    details:
      "Doce tipicamente brasileiro com textura sedosa e sabor marcante de coco.",
    price: "R$ 7,99",
  },
  {
    id: "espc-05",
    title: "Pudim de Leite Condensado",
    source: prod05,
    alt: productAlts.prod05,
    details:
      "Pudim cremoso de leite condensado com calda caramelizada, irresistível.",
    price: "R$ 10,99",
  },
];
---

<section
  aria-labelledby="menu-heading"
  role="region"
  class="min-h-screen overflow-x-hidden flex flex-col gap-[10vh] p-8 pl-1 pr-0 bg-[#ffebf2] pinkPattern bg-cover lg:gap-[8vh] xl:p-8 border-1"
>
  <NavMenu />
  <header class="pt-20 md:pt-0">
    <h1
      id="menu-heading"
      class="text-5xl text-center text-new-pink font-bold lg:text-6xl text-outline pl-4 pr-4"
    >
      Menu de doces
    </h1>
  </header>
  <main class="flex flex-col gap-16 lg:gap-18">
    <ItemsMenu sectionTitle="Doces de chocolate" arr={arrChocolate} />
    <ItemsMenu sectionTitle="Doces Veganos" arr={arrDocesVeganos} />
    <ItemsMenu sectionTitle="Biscoitos" arr={arrBiscoitos} />
    <ItemsMenu sectionTitle="Especiais da Casa" arr={arrEspeciaisDaCasa} />
  </main>
  <div class="self-center">
    <a
      href="/order"
      class="font-bold font-nunito bg-emerald-500 text-[#ffffff] p-4 rounded-3xl border-1 border-black hover:bg-emerald-400"
      aria-label="Finalizar seu pedido e ir para o carrinho de compras"
      >Finalizar pedido</a
    >
  </div>
</section>

<style>
  section {
    scrollbar-color: transparent transparent;
    scrollbar-width: thin;
  }
</style>

<script>
  import { cart, salvarCarrinho, notifyCartChange } from "../../lib/store.js";

  let total;

  document.querySelectorAll(".add-btn").forEach((button) => {
    button.addEventListener("click", (e) => {
      const card = e.target.closest(".card-item");
      if (!card) return;
      addToCart(card);

      notifyCartChange();

      salvarCarrinho();
    });
  });

  document.querySelectorAll(".rmv-btn").forEach((button) => {
    button.addEventListener("click", (e) => {
      const card = e.target.closest(".card-item");
      if (!card) return;
      removeFromCart(card);

      notifyCartChange();

      salvarCarrinho();
    });
  });

  function addToCart(card) {
    const id = card.id;
    const titulo = card.querySelector("header h3").textContent;
    const precoTexto = card.querySelector("footer p").textContent;

    const preco = parseFloat(
      precoTexto.replace("R$", "").trim().replace(/\./g, "").replace(",", ".")
    );

    const produtoExistente = cart.find((produto) => produto.id === id);

    if (produtoExistente) {
      produtoExistente.quantidade++;
      console.log(
        `Incrementando quantidade de ${titulo} para ${produtoExistente.quantidade}`
      );
      console.log(cart);
    } else {
      const novoProduto = { id, titulo, preco, quantidade: 1 };
      cart.push(novoProduto);
      console.log(`Produto adicionado: ${titulo}`);
      console.log(cart);
    }
  }

  function removeFromCart(card) {
    const id = card.id;
    const titulo = card.querySelector("header h3").textContent;

    const index = cart.findIndex((produto) => produto.id === id);

    if (index > -1) {
      if (cart[index].quantidade > 1) {
        cart[index].quantidade--;
        console.log(
          `Decrementando quantidade de ${titulo} para ${cart[index].quantidade}`
        );
      } else {
        cart.splice(index, 1);
        console.log(`Produto removido: ${titulo}`);
      }
    } else {
      console.log(`Produto ${titulo} não encontrado no carrinho.`);
    }
  }
</script>
